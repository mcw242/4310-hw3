<html>
    <head>
        <h3>Cameron Kull (cak264) & Marie Williams (mcw242)</h3>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://d3js.org/topojson.v3.min.js"></script>

        <style>
            .filter {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
            }
        </style>
    </head>
    <body>
        <svg id="map" width = 1200 height = 900 style = background-color:#d6d6d6></svg>

        <div id="filters">

        </div>

        <script>
            // constants
            const svg = d3.select("#map");
            const mapWidth = svg.attr("width");
            const mapHeight = svg.attr("height");
            let map = svg.append("g");
            let viewport = svg.append("g");

            // map setup
            const requestData = async function(){
                const pittsburgh = await d3.json("pittsburgh.geojson");
                console.log(pittsburgh);

                let yelps = await d3.csv("yelp_pittsburgh.csv", d3.autoType); 
                //trees = trees.filter(t=> t.DBH != null && t.DBH >=5 && t.qLegalStatus!= null);   
                console.log(yelps);  

                //var neighborhoods = topojson.feature(pittsburgh, pittsburgh);
                // var neighborhoodsMesh = topojson.mesh(sanfran, sanfran.objects.SFNeighborhoods);
                var projection = d3.geoMercator().fitSize([mapWidth, mapHeight], pittsburgh);
                var path = d3.geoPath().projection(projection);

                console.log(topojson.feature(pittsburgh, pittsburgh))

                // construct the visualization
                map.selectAll("path.main").data(pittsburgh.features)
                    .join("path")
                    .attr("class", "main")
                    .attr("d", path)
                    .attr('fill', '#e6e6e6');

                map.selectAll("path.neighborhoods").data(pittsburgh.features)
                    .join("path")
                    .attr("class", "neighborhoods")
                    .attr("d", path)
                    .attr('fill', 'none')
                    .attr("stroke", "black")
                    .attr("stroke-width", 1);

                // add circles

                let colorScale = d3.scaleOrdinal(d3.schemeTableau10);
                console.log(colorScale("food"));

                viewport.selectAll("circle").data(yelps)
                        .join("circle")
                        .attr("cx", y=> projection([y.longitude, y.latitude])[0])
                        .attr("cy", y=> projection([y.longitude, y.latitude])[1])
                        .attr("r", 5)
                        .attr("fill", y=> colorScale(y.type))
                        .attr("opacity", 0.8);


            // filters
            let filters = d3.select("#filters");
            
            let categories = [];
            yelps.forEach(place=>{
                if (categories.includes(place.category)==false){
                    categories.push(place.category)
                };
            });
            categories.sort();


            let categoryFilters = filters.append("g");
            let filterID = 0;
            categories.forEach(category=>{
                let filterBlock = categoryFilters.append("g")
                                                 .attr("class", "filter");
                filterBlock.append("input")
                           .attr("type", "checkbox")
                           .attr("id", "a"+filterID.toString())
                           .attr("class", "checkbox");
                filterBlock.append("label")
                           .attr("for", "a"+filterID.toString())
                           .attr("class", "a"+filterID.toString())
                           .text(category);
                filterID+=1;
            });

            function updateFilter(){
                var checkboxId = d3.select(this).attr("id");
                var isChecked = d3.select(this).property("checked");
                
                if (isChecked) {
                    handleCheckboxChecked(checkboxId);
                } else {
                    handleCheckboxUnchecked(checkboxId);
                }
            };

            // Function to handle checkbox checked event
            function handleCheckboxChecked(checkboxId) {
                console.log("Checkbox with id " + checkboxId + " was checked.");
                // Perform actions when checkbox is checked
            };

            // Function to handle checkbox unchecked event
            function handleCheckboxUnchecked(checkboxId) {
                console.log("Checkbox with id " + checkboxId + " was unchecked.");
                // Perform actions when checkbox is unchecked
            };

            d3.selectAll("input[type='checkbox']").on("click", updateFilter);



            }  
            
        
            
            requestData();
                
        </script>
    </body>
</html>